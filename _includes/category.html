{%- assign _cate_max_size = 1 -%}
{%- assign _cate_min_size = 1 -%}
{%- assign _cate_cur_size = 1 -%}
{%- assign _cates = site.categories | sort -%}
{%- for _cate in _cates -%}
  {%- assign _cate_cur_size = _cate[1].size -%}
  {%- if _cate_cur_size > _cate_max_size -%}
    {%- assign _cate_max_size =  _cate_cur_size -%}
  {%- endif -%}
  {%- if _cate_cur_size < _cate_min_size -%}
    {%- assign _cate_min_size = _cate_cur_size -%}
  {%- endif -%}
{%- endfor -%}
{%- assign _cate_gap_size =  _cate_max_size | minus: _cate_min_size | plus: 1 | divided_by: 4 -%}
{%- if _cate_gap_size < 1 -%}
  {%- assign _cate_gap_size = 1 -%}
{%- endif -%}
<div class="site-tags js-tags">
  <ul class="menu">
    <li>
      <button type="button" class="button button--secondary button--pill tag-button tag-button--all" data-encode="">
        Show All<div class="tag-button__count">{{ site.posts | size }}</div>
      </button>
    </li>
    {%- for _cate in _cates -%}
      {%- assign _cate_cur_size = _cate[1].size -%}
      {%- assign _cate_min_1 = _cate_min_size -%}
      {%- assign _cate_max_1 = _cate_min_1 | plus: _cate_gap_size -%}
      {%- assign _cate_min_2 = _cate_max_1 -%}
      {%- assign _cate_max_2 = _cate_min_2 | plus: _cate_gap_size -%}
      {%- assign _cate_min_3 = _cate_max_2 -%}
      {%- assign _cate_max_3 = _cate_min_3 | plus: _cate_gap_size -%}
      {%- assign _cate_min_4 = _cate_max_3 -%}
      {%- assign _cate_max_4 = _cate_min_4 | plus: _cate_gap_size -%}
      {%- if _cate_cur_size >= _cate_min_1 and _cate_cur_size < _cate_max_1 -%}
        {%- assign _c_index = 1 -%}
      {%- elsif _cate_cur_size >= _cate_min_2 and _cate_cur_size < _cate_max_2 -%}
        {%- assign _c_index = 2 -%}
      {%- elsif _cate_cur_size >= _cate_min_3 and _cate_cur_size < _cate_max_3 -%}
        {%- assign _c_index = 3 -%}
      {%- elsif _cate_cur_size >= _cate_min_4 and _cate_cur_size < _cate_max_4 -%}
        {%- assign _c_index = 4 -%}
      {%- else -%}
        {%- assign _c_index = 4 -%}
      {%- endif -%}
      <li><button type="button" class="button button--pill tag-button tag-button-{{ _c_index }}" data-encode="{{ _cate[0] | strip | url_encode }}">
          <span>{{ _cate[0] | strip }}</span><div class="tag-button__count">{{ _cate[1].size }}</div>
        </button>
      </li>
    {%- endfor -%}
  </ul>
</div>
